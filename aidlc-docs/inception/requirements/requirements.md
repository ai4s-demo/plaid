# Smart Campaign Designer 需求规格说明书

## 1. 项目概述

### 1.1 意图分析
- **用户请求**: 创建一个对话式 AI Agent 网站，帮助科学家通过自然语言设计微孔板布局并生成 Echo Picklist
- **请求类型**: 新项目 (Greenfield)
- **范围估计**: 多组件系统（前端 + 后端 + AI Agent + 约束求解器）
- **复杂度估计**: 中等偏高

### 1.2 项目背景
基于 PLAID (Plate Layouts using Artificial Intelligence Design) 方法论，使用约束编程生成优化的微孔板布局，减少板效应对实验数据的影响。

### 1.3 项目目标
构建 Smart Campaign Designer，使科学家能够：
1. 通过自然语言对话描述实验设计需求
2. 自动生成符合 PLAID 约束的优化布局
3. 输出可直接用于 Echo 液体处理机器人的 Picklist 文件

---

## 2. 功能需求

### FR-001: 对话式 AI Agent
**优先级**: 高

| ID | 需求描述 |
|----|----------|
| FR-001.1 | Agent 支持中英文双语对话 |
| FR-001.2 | Agent 具备高级智能：能主动提问、建议优化方案、解释设计原理 |
| FR-001.3 | 当用户输入不完整时，Agent 主动询问缺失信息 |
| FR-001.4 | Agent 能理解自然语言描述的实验需求，如 "10个基因随机分布在96孔板，外圈留空，每个6个重复" |
| FR-001.5 | Agent 能解释布局设计的原理和约束条件 |

### FR-002: 源板信息输入
**优先级**: 高

| ID | 需求描述 |
|----|----------|
| FR-002.1 | 支持 Excel (.xlsx, .xls) 文件上传 |
| FR-002.2 | 支持 CSV 文件上传 |
| FR-002.3 | 自动解析源板信息：板条码、孔位置、基因/化合物名称、体积、浓度等 |
| FR-002.4 | 文件格式验证和错误提示 |

### FR-003: 微孔板布局设计
**优先级**: 高

| ID | 需求描述 |
|----|----------|
| FR-003.1 | 支持 96 孔板布局设计 |
| FR-003.2 | 支持 384 孔板布局设计 |
| FR-003.3 | 支持 1536 孔板布局设计 |
| FR-003.4 | 支持配置边缘空白层数（减少边缘效应） |
| FR-003.5 | 支持配置重复数 |
| FR-003.6 | 支持多种分布方式：随机、按列、按行 |
| FR-003.7 | 支持阳性/阴性对照配置 |
| FR-003.8 | （高级功能）支持多层设计（如基因层 + 处理层） |

### FR-004: 约束优化
**优先级**: 高

| ID | 需求描述 |
|----|----------|
| FR-004.1 | 使用 Python OR-Tools 实现约束求解 |
| FR-004.2 | 实现对照样品均匀分布约束（象限、行、列平衡） |
| FR-004.3 | 实现同类型对照不相邻约束（8方向） |
| FR-004.4 | 实现浓度分散约束（不同浓度在不同行/列） |
| FR-004.5 | 实现复制品分散约束 |

### FR-005: 输出生成
**优先级**: 高

| ID | 需求描述 |
|----|----------|
| FR-005.1 | 生成 Echo Picklist CSV 文件（包含源板、源孔、目标板、目标孔、转移体积等） |
| FR-005.2 | 生成可视化板布局图（热力图/网格图） |
| FR-005.3 | 生成 PDF 报告（包含设计参数、布局图、统计信息） |
| FR-005.4 | 支持文件下载 |

### FR-006: 用户界面
**优先级**: 高

| ID | 需求描述 |
|----|----------|
| FR-006.1 | 聊天式对话界面 |
| FR-006.2 | 文件上传区域 |
| FR-006.3 | 实时布局预览 |
| FR-006.4 | 设计参数显示/编辑面板 |
| FR-006.5 | 下载按钮区域 |

---

## 3. 非功能需求

### NFR-001: 性能
| ID | 需求描述 |
|----|----------|
| NFR-001.1 | 布局生成响应时间 < 30 秒 |
| NFR-001.2 | 支持 1-10 并发用户 |
| NFR-001.3 | 页面加载时间 < 3 秒 |

### NFR-002: 可用性
| ID | 需求描述 |
|----|----------|
| NFR-002.1 | 界面简洁直观，科学家无需培训即可使用 |
| NFR-002.2 | 提供清晰的错误提示和帮助信息 |
| NFR-002.3 | 支持中英文界面 |

### NFR-003: 安全性
| ID | 需求描述 |
|----|----------|
| NFR-003.1 | 无需用户认证（内部使用） |
| NFR-003.2 | 上传文件大小限制（防止滥用） |
| NFR-003.3 | 输入验证防止注入攻击 |

### NFR-004: 可维护性
| ID | 需求描述 |
|----|----------|
| NFR-004.1 | 代码模块化，约束逻辑与业务逻辑分离 |
| NFR-004.2 | 提供 API 文档 |
| NFR-004.3 | 日志记录关键操作 |

---

## 4. 技术架构

### 4.1 技术栈
| 层级 | 技术选型 |
|------|----------|
| 前端 | React |
| 后端 | Python (FastAPI) |
| AI/LLM | Amazon Bedrock (Claude) |
| 约束求解 | Python OR-Tools（直接集成） |
| 部署 | 本地服务器 |

### 4.2 系统架构概览
```
┌─────────────────────────────────────────────────────────────┐
│                      用户浏览器                              │
│                    (React 前端)                              │
└─────────────────────┬───────────────────────────────────────┘
                      │ HTTP/WebSocket
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                   Python 后端 (FastAPI)                      │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────┐  │
│  │ 文件处理    │  │ Agent 编排  │  │ Picklist 生成       │  │
│  └─────────────┘  └──────┬──────┘  └─────────────────────┘  │
│                          │                                   │
│  ┌───────────────────────┴───────────────────────────────┐  │
│  │              OR-Tools 约束求解器（直接集成）           │  │
│  └───────────────────────────────────────────────────────┘  │
└──────────────────────────┬──────────────────────────────────┘
                           │
          ┌────────────────┴────────────────┐
          ▼                                 ▼
┌─────────────────┐               ┌─────────────────────────┐
│ Amazon Bedrock  │               │ 文件存储               │
│ (Claude)        │               │ (临时)                 │
└─────────────────┘               └─────────────────────────┘
```

---

## 5. 数据格式

### 5.1 输入：源板列表 (Source List)
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| plate_barcode | string | 是 | 源板条码 |
| well_alpha | string | 是 | 源孔位置 (如 A01) |
| gene_symbol | string | 是 | 基因/化合物名称 |
| Volume_Requested | float | 否 | 请求体积 |
| Quantity_Requested | float | 否 | 请求量 |

### 5.2 输出：Echo Picklist
| 字段 | 类型 | 说明 |
|------|------|------|
| Source Plate Barcode | string | 源板条码 |
| Source Well | string | 源孔位置 |
| Source Plate Type | string | 源板类型 |
| Destination Plate Barcode | string | 目标板条码 |
| Destination Plate Type | string | 目标板类型 |
| Destination Well | string | 目标孔位置 |
| Transfer Volume | float | 转移体积 |
| GENE_SYMBOL | string | 基因名称 |

---

## 6. 项目范围

### 6.1 包含范围
- Smart Campaign Designer 核心功能
- 对话式 AI Agent
- 微孔板布局优化
- Echo Picklist 生成
- 可视化和报告

### 6.2 排除范围
- 用户认证系统
- 历史设计存储
- TDeasy 数据可视化模块
- TCMapp 集成
- TD Analysis Tool 集成

---

## 7. 约束与假设

### 7.1 约束
- 本地服务器部署
- 使用 Amazon Bedrock 需要有效的 AWS 凭证
- Python OR-Tools 需要 Python 运行环境

### 7.2 假设
- 用户熟悉微孔板实验基本概念
- 源板列表文件格式符合预期
- 网络环境可访问 Amazon Bedrock 服务

---

## 8. 验收标准

| ID | 验收标准 |
|----|----------|
| AC-001 | 用户可通过自然语言描述实验需求，Agent 正确理解并生成布局 |
| AC-002 | 上传源板文件后，系统正确解析并显示内容 |
| AC-003 | 生成的布局满足 PLAID 约束（对照分散、无相邻同类型等） |
| AC-004 | 生成的 Echo Picklist 格式正确，可直接用于 Echo 机器人 |
| AC-005 | 布局生成时间 < 30 秒 |
| AC-006 | 可视化布局图清晰展示样品分布 |
