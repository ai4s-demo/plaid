# Smart Campaign Designer 单元依赖矩阵

## 单元间依赖

```
┌──────────────┐         HTTP/SSE          ┌──────────────┐
│              │ ─────────────────────────→ │              │
│   Frontend   │                            │   Backend    │
│   (React)    │ ←───────────────────────── │   (FastAPI)  │
│              │         JSON/SSE           │              │
└──────────────┘                            └──────────────┘
                                                   │
                                                   │ HTTPS
                                                   ▼
                                            ┌──────────────┐
                                            │   Amazon     │
                                            │   Bedrock    │
                                            └──────────────┘
```

## 依赖矩阵

| 单元 | 依赖于 | 依赖类型 | 说明 |
|------|--------|----------|------|
| Frontend | Backend | 运行时 | API 调用 |
| Backend | Amazon Bedrock | 运行时 | AI 服务 |
| Backend | - | 无 | 可独立运行 |

## 模块间依赖（Backend 内部）

```
┌─────────────────────────────────────────────────────────────┐
│                        Backend                               │
│                                                             │
│  ┌─────────┐                                                │
│  │ Routers │ ──────────────────────────────────────────┐    │
│  │ (API)   │                                           │    │
│  └────┬────┘                                           │    │
│       │                                                │    │
│       ▼                                                ▼    │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                    Services                          │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌────────────┐ │   │
│  │  │AgentService  │  │ FileService  │  │LayoutService│ │   │
│  │  └──────┬───────┘  └──────────────┘  └──────┬─────┘ │   │
│  │         │                                    │       │   │
│  │         │                                    ▼       │   │
│  │         │                            ┌────────────┐  │   │
│  │         │                            │  Solver    │  │   │
│  │         │                            │ (OR-Tools) │  │   │
│  │         │                            └────────────┘  │   │
│  └─────────┼────────────────────────────────────────────┘   │
│            │                                                 │
│            ▼                                                 │
│  ┌─────────────────┐                                        │
│  │     Models      │ ←── 所有模块共享                        │
│  └─────────────────┘                                        │
└─────────────────────────────────────────────────────────────┘
```

## 模块依赖详情

### Routers (API 层)

| 模块 | 依赖 | 说明 |
|------|------|------|
| chat.py | AgentService, Models | 对话 API |
| file.py | FileService, Models | 文件 API |
| layout.py | LayoutService, Models | 布局 API |

### Services (服务层)

| 模块 | 依赖 | 说明 |
|------|------|------|
| agent_service.py | boto3, Models | Bedrock 集成 |
| file_service.py | openpyxl, pandas, Models | 文件解析 |
| layout_service.py | Solver, Models | 布局生成 |

### Solver (求解器)

| 模块 | 依赖 | 说明 |
|------|------|------|
| constraint_solver.py | ortools, Models | 约束求解 |
| constraints.py | ortools | 约束定义 |

### Models (数据模型)

| 模块 | 依赖 | 说明 |
|------|------|------|
| source_plate.py | pydantic | 源板模型 |
| design_parameters.py | pydantic | 设计参数 |
| plate_layout.py | pydantic | 布局模型 |
| picklist.py | pydantic | Picklist 模型 |

## 模块间依赖（Frontend 内部）

```
┌─────────────────────────────────────────────────────────────┐
│                        Frontend                              │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                      App.tsx                         │   │
│  └───────────────────────────┬─────────────────────────┘   │
│                              │                              │
│       ┌──────────────────────┼──────────────────────┐      │
│       ▼                      ▼                      ▼      │
│  ┌──────────┐          ┌──────────┐          ┌──────────┐  │
│  │ChatPanel │          │PlateView │          │Download  │  │
│  │          │ ───────→ │          │ ───────→ │Panel     │  │
│  └────┬─────┘          └────┬─────┘          └────┬─────┘  │
│       │                     │                     │        │
│       └─────────────────────┼─────────────────────┘        │
│                             ▼                              │
│                    ┌─────────────────┐                     │
│                    │    Hooks        │                     │
│                    │ useChat, usePlate│                    │
│                    └────────┬────────┘                     │
│                             │                              │
│                             ▼                              │
│                    ┌─────────────────┐                     │
│                    │   API Client    │                     │
│                    │   (services/)   │                     │
│                    └─────────────────┘                     │
└─────────────────────────────────────────────────────────────┘
```

## 构建依赖

| 单元 | 构建工具 | 输出 |
|------|----------|------|
| Frontend | Vite | dist/ (静态文件) |
| Backend | pip | Python 包 |

## 部署依赖

| 组件 | 依赖 | 说明 |
|------|------|------|
| Frontend 静态文件 | Nginx | 静态文件服务 |
| Backend | Uvicorn | ASGI 服务器 |
| Backend | AWS 凭证 | Bedrock 访问 |
